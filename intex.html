<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAHAYARAJ-2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root { --p-bg: #0c40bb; --n-col: #ffffff; --out: #54301d; --btm: #0b08d4; --c-let: #e32b2b; --c-num: #1e40af; }
        body { background-color: #475569; font-family: 'Arial Black', sans-serif; }
        * { font-weight: 950 !important; }
        .main-app-box { border: 10px solid var(--out); margin: 10px auto; border-radius: 40px; background: #f1f5f9; overflow-x: hidden; transition: 0.3s; }
        .premium-header { background-color: var(--p-bg); padding: 25px; border-bottom: 10px solid var(--btm); }
        .cat-card { background: #fff; border: 5px solid var(--out); border-radius: 20px; text-align: center; }
        .btn-style { border-bottom: 6px solid #000; color: #fff !important; cursor: pointer; transition: 0.1s; text-transform: uppercase; }
        .btn-style:active { transform: translateY(3px); border-bottom-width: 3px; }
        .cp-card { background: #fff; width: 98%; max-width: 1300px; border-radius: 40px; padding: 20px; border: 10px solid #000; max-height: 95vh; overflow-y: auto; }
        .setting-row { display: flex; justify-content: space-between; align-items: center; background: #f8fafc; padding: 5px 10px; border: 2px solid #000; border-radius: 10px; margin-bottom: 2px; font-size: 11px; }
        .filter-btn-active { background-color: #ef4444 !important; border: 3px solid #000 !important; }
    </style>
</head>
<body onload="init()">

<div id="appPage">
    <div id="mainContainer" class="main-app-box mx-auto">
        <div class="premium-header">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <button onclick="location.reload()" id="backBtn" class="bg-red-600 w-12 h-12 rounded-full border-4 border-black text-white text-2xl">‚¨Ö</button>
                    <div>
                        <h1 id="dispTitle" class="text-4xl italic uppercase" style="color: var(--n-col);">SAHAYARAJ-2026</h1>
                        </div>
                </div>
                <div class="flex items-center gap-6">
                    <div class="text-right text-white">
                        <p class="text-xs opacity-70">RECORDS: <span id="recCount" class="text-yellow-400">0</span></p>
                        <h2 id="mainTotal" class="text-4xl">‚Çπ0</h2>
                    </div>
                    <button onclick="openSettings()" class="text-5xl text-white">‚öôÔ∏è</button>
                </div>
            </div>
        </div>

        <div class="p-6">
            <div id="catGrid" class="grid grid-cols-2 md:grid-cols-7 gap-3 mb-6"></div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white p-5 rounded-3xl border-4 border-black">
                    <h3 class="text-xl border-b-4 border-green-600 mb-4 italic uppercase">New Entry</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <input type="date" id="eDate" class="border-2 border-black p-2 rounded">
                        <input type="tel" id="eMob" placeholder="Mobile" class="border-2 border-black p-2 rounded">
                        <select id="eCat" class="border-2 border-black p-2 rounded"></select>
                        <input type="text" id="eDesc" placeholder="Remark" class="border-2 border-black p-2 rounded">
                        <input type="number" id="eAmt" placeholder="Amount" class="border-2 border-black p-2 rounded">
                        <select id="eType" class="border-2 border-black p-2 rounded"><option value="CR">IN (+)</option><option value="DR">OUT (-)</option></select>
                    </div>
                    <button onclick="saveData()" class="w-full py-4 mt-5 rounded-xl text-xl btn-style bg-green-600">SAVE ‚úÖ</button>
                </div>
                <div class="bg-white p-5 rounded-3xl border-4 border-black">
                    <h3 class="text-xl border-b-4 border-blue-600 mb-4 italic uppercase">Search & Tools</h3>
                    <div class="grid grid-cols-3 gap-2 mb-4">
                        <input type="date" id="fDate" class="text-xs border-2 border-black p-1">
                        <input type="date" id="tDate" class="text-xs border-2 border-black p-1">
                        <input type="tel" id="sMob" placeholder="Mobile" class="text-xs border-2 border-black p-1">
                    </div>
                    <div id="filterCatList" class="flex flex-wrap gap-2 mb-4"></div>
                    <div class="grid grid-cols-3 gap-3">
                        <button id="toolPdf" onclick="downloadPDF()" class="bg-orange-600 py-3 rounded-lg btn-style text-[10px]">PDF</button>
                        <button id="toolWa" onclick="sendWhatsApp()" class="bg-green-600 py-3 rounded-lg btn-style text-[10px]">WHATSAPP</button>
                        <button id="toolDelAll" onclick="deleteAll()" class="bg-red-600 py-3 rounded-lg btn-style text-[10px]">DELETE ALL</button>
                    </div>
                    <div class="grid grid-cols-2 gap-3 mt-3">
                        <button id="toolImp" onclick="document.getElementById('impF').click()" class="bg-gray-700 py-3 rounded-lg btn-style text-[10px]">IMPORT</button>
                        <button id="toolExp" onclick="exportData()" class="bg-gray-700 py-3 rounded-lg btn-style text-[10px]">EXPORT</button>
                        <input type="file" id="impF" class="hidden" onchange="importData(event)">
                    </div>
                    <button onclick="refresh()" class="w-full bg-slate-800 text-white py-3 mt-3 rounded-xl btn-style">SEARCH DATA üîé</button>
                </div>
            </div>
            <div class="mt-6 bg-white border-4 border-black rounded-3xl overflow-hidden">
                <table class="w-full text-sm" id="mainTable">
                    <thead class="bg-black text-white"><tr><th class="p-2">DATE</th><th class="p-2">MOBILE</th><th class="p-2">CAT</th><th class="p-2">REMARK</th><th class="p-2 text-right">AMOUNT</th><th class="p-2 text-center">ACTION</th></tr></thead>
                    <tbody id="resTable" class="text-center"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div id="setModal" class="hidden fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-2">
    <div class="cp-card">
        <div class="flex justify-between items-center mb-4"><h2 class="text-2xl uppercase">System Control Panel</h2><button onclick="closeSettings()" class="bg-red-600 text-white px-4 py-2 rounded-xl btn-style">CLOSE</button></div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="space-y-1"><p class="bg-blue-900 text-white p-1 text-[10px] uppercase">1. Color Settings</p>
                <div class="setting-row"><span>01. Banner Color</span><input type="color" id="setHeadCol"></div>
                <div class="setting-row"><span>02. Name Color</span><input type="color" id="setNameCol"></div>
                <div class="setting-row"><span>03. Outline Color</span><input type="color" id="setOutCol"></div>
                <div class="setting-row"><span>04. Pattern Btm</span><input type="color" id="setBtmCol"></div>
                <div class="setting-row"><span>05. Cat Letter Col</span><input type="color" id="setCatLetCol"></div>
                <div class="setting-row"><span>06. Cat Number Col</span><input type="color" id="setCatNumCol"></div>
            </div>
            <div class="space-y-1"><p class="bg-green-900 text-white p-1 text-[10px] uppercase">2. Font & Sizes</p>
                <div class="setting-row"><span>07. Banner Name</span><input type="text" id="setName" class="w-20"></div>
                <div class="setting-row"><span>08. Date/Time Size</span><input type="number" id="fsDT" class="w-12"></div>
                <div class="setting-row"><span>09. Cat Letter Size</span><input type="number" id="fsCatL" class="w-12"></div>
                <div class="setting-row"><span>10. Cat Number Size</span><input type="number" id="fsCatN" class="w-12"></div>
                <div class="setting-row"><span>11. Entry Font Size</span><input type="number" id="fsEnt" class="w-12"></div>
                <div class="setting-row"><span>12. Width %</span><input type="number" id="setScrW" class="w-12"></div>
                <div class="setting-row"><span>13. Height px</span><input type="number" id="setScrH" class="w-12"></div>
            </div>
            <div class="space-y-1"><p class="bg-orange-900 text-white p-1 text-[10px] uppercase">3. On/Off Switches</p>
                <div class="setting-row"><span>14. Back Button</span><input type="checkbox" id="swBack"></div>
                <div class="setting-row"><span>15. Show Date</span><input type="checkbox" id="swDate"></div>
                <div class="setting-row"><span>16. Show Clock</span><input type="checkbox" id="swClock"></div>
                <div class="setting-row"><span>19. Edit Pen</span><input type="checkbox" id="swPen"></div>
                <div class="setting-row"><span>20. Single Delete</span><input type="checkbox" id="swTrDel"></div>
                <div class="setting-row"><span>21. All Delete Sw</span><input type="checkbox" id="swAllDel"></div>
                <div class="setting-row"><span>22. Import Sw</span><input type="checkbox" id="setSwImp"></div>
                <div class="setting-row"><span>23. Export Sw</span><input type="checkbox" id="setSwExp"></div>
                <div class="setting-row"><span>24. PDF Sw</span><input type="checkbox" id="swPdf"></div>
                <div class="setting-row"><span>25. WhatsApp Sw</span><input type="checkbox" id="swWa"></div>
            </div>
            <div class="space-y-1"><p class="bg-red-900 text-white p-1 text-[10px] uppercase">4. Categories</p>
                <div id="catEditArea" class="space-y-1"></div>
                <div class="setting-row"><span>Admin PIN</span><input type="text" id="setAp" class="w-12"></div>
                <div class="setting-row"><span>Multi-Filter</span><input type="checkbox" id="setMFS"></div>
            </div>
        </div>
        <button onclick="saveSettings()" class="w-full bg-blue-700 text-white py-4 mt-4 rounded-xl text-2xl btn-style">SAVE ALL SETTINGS ‚úÖ</button>
    </div>
</div>

<script>
// --- ‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æï‡Øä‡Æü‡ØÅ‡Æ§‡Øç‡Æ§ 46 ‡Æ∞‡ØÜ‡Æï‡Øç‡Æï‡Ææ‡Æ∞‡Øç‡Æü‡ØÅ‡Æï‡Æ≥‡Øç ---
const initialDb = [{"id":1771307247091,"date":"2026-02-17","mob":"9629652228","cat":"TICKET","desc":"PRE GOLD -2","amt":600,"type":"CR"},{"id":1771217880832,"date":"2026-02-16","mob":"77708032459","cat":"TICKET","desc":"NALLAKANNU50-1","amt":600,"type":"CR"},{"id":1771217923824,"date":"2026-02-16","mob":"9942984822","cat":"TICKET","desc":"ULAGAM-2","amt":600,"type":"CR"},{"id":1771159270835,"date":"2026-02-15","mob":"9361203202","cat":"TICKET","desc":"dhan-anand-1","amt":300,"type":"CR"},{"id":1771090378673,"date":"2026-02-14","mob":"-","cat":"TICKET","desc":"KAVITHAPALANI-1","amt":300,"type":"CR"},{"id":1771090264033,"date":"2026-02-13","mob":"-","cat":"TICKET","desc":"QUINRANI-3","amt":900,"type":"CR"},{"id":1771091468195,"date":"2026-02-13","mob":"9751336780","cat":"RO","desc":"KANAGAVEL-AU","amt":650,"type":"CR"},{"id":1771091507314,"date":"2026-02-13","mob":"-","cat":"TICKET","desc":"SONAIMUTHU1975-3","amt":900,"type":"CR"},{"id":1771089935160,"date":"2026-02-11","mob":"9361203202","cat":"TICKET","desc":"DHANHIND-2","amt":600,"type":"CR"},{"id":1771089967681,"date":"2026-02-11","mob":"-","cat":"TICKET","desc":"VEERAMMAL1987-2","amt":600,"type":"CR"},{"id":1771090022433,"date":"2026-02-11","mob":"-","cat":"TICKET","desc":"DEVAN4455-2","amt":600,"type":"CR"},{"id":1771090049418,"date":"2026-02-11","mob":"9361203202","cat":"TICKET","desc":"DHANHIND-14","amt":1000,"type":"CR"},{"id":1771090124778,"date":"2026-02-11","mob":"8608989987","cat":"RO","desc":"SARAN-AKKA-2500","amt":1250,"type":"CR"},{"id":1771090164969,"date":"2026-02-11","mob":"9842110036","cat":"FINANCE","desc":"NALLA KANNU","amt":500,"type":"CR"},{"id":1771090192577,"date":"2026-02-11","mob":"-","cat":"TICKET","desc":"CHELLAPANDI1975-2","amt":600,"type":"CR"},{"id":1771089754609,"date":"2026-02-09","mob":"9842110036","cat":"FINANCE","desc":"NALLA KANNU","amt":1000,"type":"CR"},{"id":1771089890754,"date":"2026-02-09","mob":"-","cat":"TICKET","desc":"PURUSHOTHA-2","amt":600,"type":"CR"},{"id":1771089652289,"date":"2026-02-07","mob":"8668187812","cat":"FINANCE","desc":"TVS PRABU","amt":500,"type":"CR"},{"id":1771090693530,"date":"2026-02-07","mob":"9042012717","cat":"FINANCE","desc":"UMANATTH","amt":600,"type":"CR"},{"id":1771089040497,"date":"2026-02-06","mob":"-","cat":"TICKET","desc":"SUPRAMANI-6","amt":1500,"type":"CR"},{"id":1771089126416,"date":"2026-02-06","mob":"7639860076","cat":"RO","desc":"MATHI-DENTAL","amt":2000,"type":"CR"},{"id":1771089538809,"date":"2026-02-06","mob":"9361203202","cat":"TICKET","desc":"DHANHIND","amt":300,"type":"CR"},{"id":1771088802224,"date":"2026-02-05","mob":"-","cat":"TICKET","desc":"ZOOMCAR-1","amt":300,"type":"CR"},{"id":1771088833968,"date":"2026-02-05","mob":"-","cat":"TICKET","desc":"SEGAR1990-2","amt":600,"type":"CR"},{"id":1771088925649,"date":"2026-02-05","mob":"9361203202","cat":"TICKET","desc":"DHANHIND-1","amt":400,"type":"CR"},{"id":1771090856331,"date":"2026-02-04","mob":"-","cat":"TICKET","desc":"REFUND-2","amt":200,"type":"CR"},{"id":1771088742217,"date":"2026-02-03","mob":"8668187812","cat":"FINANCE","desc":"TVS-PRABU","amt":1000,"type":"CR"},{"id":1771090543577,"date":"2026-02-03","mob":"-","cat":"TICKET","desc":"NAGARAJ1978-1","amt":300,"type":"CR"},{"id":1771088590792,"date":"2026-02-02","mob":"-","cat":"TICKET","desc":"REFUND-4","amt":100,"type":"CR"},{"id":1771088640432,"date":"2026-02-01","mob":"-","cat":"FINANCE","desc":"ANANDA KANNAN","amt":2000,"type":"CR"},{"id":1771088972585,"date":"2026-02-01","mob":"9361203202","cat":"TICKET","desc":"DHANHIND-1","amt":700,"type":"CR"},{"id":1771468739929,"date":"2026-02-19","mob":"9994871366","cat":"TICKET","desc":"SUDALAIMUTHUU1987 - 6 - G","amt":900,"type":"CR"},{"id":1771479642646,"date":"2026-02-19","mob":"9943575504","cat":"TICKET","desc":"VEERAM22 -- 1","amt":800,"type":"CR"},{"id":1771479788469,"date":"2026-02-19","mob":"9994150855","cat":"TICKET","desc":"JEROLIN-1","amt":300,"type":"CR"},{"id":1771648971459,"date":"2026-02-21","mob":"9994150885","cat":"TICKET","desc":"ZION3242","amt":600,"type":"CR"},{"id":1771655691539,"date":"2026-02-21","mob":"9600272698","cat":"TICKET","desc":"VEERAMMAL1987 -1 - AGEND","amt":200,"type":"CR"},{"id":1771691516077,"date":"2026-02-21","mob":"9944232105","cat":"FINANCE","desc":"VENGADESH - GOLD","amt":3000,"type":"CR"},{"id":1771849859980,"date":"2026-02-22","mob":"9944578595","cat":"TICKET","desc":"PRASANNAKAS2011 - 1","amt":300,"type":"CR"},{"id":1771900509549,"date":"2026-02-23","mob":"8668187812","cat":"FINANCE","desc":"TVS- PRABHU","amt":1250,"type":"CR"},{"id":1771900567245,"date":"2026-02-23","mob":"9842984164","cat":"FINANCE","desc":"MOHAN-SAN","amt":500,"type":"CR"},{"id":1771909199431,"date":"2026-02-24","mob":"944270666","cat":"TICKET","desc":"VINU998855 - 1","amt":300,"type":"CR"},{"id":1772003295215,"date":"2026-02-24","mob":"7010571557","cat":"OTHER","desc":"PRAKASH-CRITED- CARD","amt":50,"type":"CR"},{"id":1772084876780,"date":"2026-02-26","mob":"9842111492","cat":"TICKET","desc":"VIJAYALAKSHMI1952 -2","amt":600,"type":"CR"},{"id":1772084922364,"date":"2026-02-26","mob":"9629652228","cat":"TICKET","desc":"QQRAMA - 1","amt":300,"type":"CR"},{"id":1772185442118,"date":"2026-02-26","mob":"902596006","cat":"RO","desc":"SARAN","amt":5000,"type":"CR"},{"id":1772185531550,"date":"2026-02-27","mob":"9944522994","cat":"RO","desc":"RAJKUMAR-NEW-RO-XL","amt":6100,"type":"DR"}];

// --- ‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æï‡Øä‡Æü‡ØÅ‡Æ§‡Øç‡Æ§ Configuration ---
let cfg = JSON.parse(localStorage.getItem('saha_v65_cfg')) || {"title":"SAHAYARAJ-2026","headCol":"#0c40bb","nameCol":"#ffffff","outCol":"#54301d","btmCol":"#0b08d4","catLetCol":"#e32b2b","catNumCol":"#1e40af","scrW":95,"scrH":867,"fsDT":22,"fsCatL":16,"fsCatN":32,"fsEnt":18,"swBack":true,"swDate":true,"swClock":true,"swPen":true,"swTrDel":true,"swAllDel":true,"swPdf":true,"swWa":true,"swImp":true,"swExp":true,"mfs":true,"adminPin":"1020","cats":["TICKET","FINANCE","RO","OTHER","SHOP","GENERAL","EXTRA"],"catStatus":[true,true,true,true,true,true,true]};

if(!localStorage.getItem('saha_v65_db')) localStorage.setItem('saha_v65_db', JSON.stringify(initialDb));
let db = JSON.parse(localStorage.getItem('saha_v65_db'));

let activeFilters = [];

function init() {
    document.documentElement.style.setProperty('--p-bg', cfg.headCol);
    document.documentElement.style.setProperty('--n-col', cfg.nameCol);
    document.documentElement.style.setProperty('--btm', cfg.btmCol);
    document.documentElement.style.setProperty('--out', cfg.outCol);
    document.documentElement.style.setProperty('--c-let', cfg.catLetCol);
    document.documentElement.style.setProperty('--c-num', cfg.catNumCol);
    
    const container = document.getElementById('mainContainer');
    container.style.width = cfg.scrW + "%";
    container.style.minHeight = cfg.scrH + "px";
    
    document.getElementById('dispTitle').innerText = cfg.title;
    document.getElementById('backBtn').style.display = cfg.swBack ? 'block' : 'none';

    document.getElementById('toolImp').style.display = cfg.swImp ? 'block' : 'none';
    document.getElementById('toolExp').style.display = cfg.swExp ? 'block' : 'none';
    document.getElementById('toolPdf').style.display = cfg.swPdf ? 'block' : 'none';
    document.getElementById('toolWa').style.display = cfg.swWa ? 'block' : 'none';
    document.getElementById('toolDelAll').style.display = cfg.swAllDel ? 'block' : 'none';

    renderUI(); refresh();
}

function renderUI() {
    const grid = document.getElementById('catGrid'), eSel = document.getElementById('eCat'), fList = document.getElementById('filterCatList');
    grid.innerHTML = ""; eSel.innerHTML = ""; fList.innerHTML = `<button onclick="toggleFilter('ALL')" id="btn_ALL" class="bg-blue-900 text-white px-3 py-1 rounded-lg btn-style text-[10px] filter-btn-active">ALL</button>`;
    
    cfg.cats.forEach((c, i) => {
        if(cfg.catStatus[i]) {
            grid.innerHTML += `<div class="cat-card"><p style="font-size:${cfg.fsCatL}px; color:var(--c-let)">${c}</p><h3 style="font-size:${cfg.fsCatN}px; color:var(--c-num)">‚Çπ<span id="sum_${c}">0</span></h3></div>`;
            eSel.innerHTML += `<option value="${c}">${c}</option>`;
            fList.innerHTML += `<button onclick="toggleFilter('${c}')" id="btn_${c}" class="bg-blue-900 text-white px-3 py-1 rounded-lg btn-style text-[10px]">${c}</button>`;
        }
    });
}

function refresh() {
    const fD = document.getElementById('fDate').value, tD = document.getElementById('tDate').value, sM = document.getElementById('sMob').value;
    let html = "", grand = 0, cSums = {}; cfg.cats.forEach(c => cSums[c] = 0);
    
    db.sort((a, b) => b.id - a.id);

    let filtered = db.filter(t => {
        const mCat = (activeFilters.length === 0 || activeFilters.includes(t.cat));
        const mDate = (!fD || t.date >= fD) && (!tD || t.date <= tD);
        const mMob = (!sM || t.mob.includes(sM));
        return mCat && mDate && mMob;
    });

    filtered.forEach(t => {
        let v = (t.type === "CR") ? t.amt : -t.amt; cSums[t.cat] += v; grand += v;
        html += `<tr class="border-b">
            <td class="p-2">${t.date.split('-').reverse().join('/')}</td>
            <td class="p-2">${t.mob}</td>
            <td class="p-2">${t.cat}</td>
            <td class="p-2 text-blue-700">${t.desc}</td>
            <td class="p-2 text-right ${t.type==='CR'?'text-green-600':'text-red-600'}">‚Çπ${t.amt.toLocaleString()}</td>
            <td class="p-2">${cfg.swPen?'üñäÔ∏è':''} ${cfg.swTrDel?`<button onclick="del(${t.id})" class="text-red-600 ml-1">‚úñ</button>`:''}</td>
        </tr>`;
    });
    
    document.getElementById('resTable').innerHTML = html;
    document.getElementById('mainTotal').innerText = "‚Çπ" + grand.toLocaleString();
    document.getElementById('recCount').innerText = filtered.length;
    cfg.cats.forEach(c => { if(document.getElementById('sum_'+c)) document.getElementById('sum_'+c).innerText = (cSums[c] || 0).toLocaleString(); });
}

function saveData() {
    let entry = { id: Date.now(), date: document.getElementById('eDate').value, mob: document.getElementById('eMob').value || "-", cat: document.getElementById('eCat').value, desc: document.getElementById('eDesc').value || "-", amt: parseFloat(document.getElementById('eAmt').value || 0), type: document.getElementById('eType').value };
    if(!entry.date || entry.amt <= 0) return alert("Check Details!");
    db.push(entry); localStorage.setItem('saha_v65_db', JSON.stringify(db)); refresh();
}

function toggleFilter(cat) {
    if(!cfg.mfs) { activeFilters = (cat === 'ALL') ? [] : [cat]; } 
    else {
        if(cat === 'ALL') activeFilters = [];
        else {
            const index = activeFilters.indexOf(cat);
            if(index > -1) activeFilters.splice(index, 1);
            else activeFilters.push(cat);
        }
    }
    updateFilterUI(); refresh();
}

function updateFilterUI() {
    document.querySelectorAll('#filterCatList button').forEach(btn => btn.classList.remove('filter-btn-active'));
    if(activeFilters.length === 0) document.getElementById('btn_ALL').classList.add('filter-btn-active');
    else activeFilters.forEach(cat => document.getElementById('btn_'+cat)?.classList.add('filter-btn-active'));
}

function openSettings() {
    if(prompt("ADMIN PIN:") === cfg.adminPin) {
        document.getElementById('setModal').classList.remove('hidden');
        document.getElementById('setHeadCol').value = cfg.headCol;
        document.getElementById('setNameCol').value = cfg.nameCol;
        document.getElementById('setOutCol').value = cfg.outCol;
        document.getElementById('setBtmCol').value = cfg.btmCol;
        document.getElementById('setCatLetCol').value = cfg.catLetCol;
        document.getElementById('setCatNumCol').value = cfg.catNumCol;
        document.getElementById('setName').value = cfg.title;
        document.getElementById('fsDT').value = cfg.fsDT;
        document.getElementById('fsCatL').value = cfg.fsCatL;
        document.getElementById('fsCatN').value = cfg.fsCatN;
        document.getElementById('fsEnt').value = cfg.fsEnt;
        document.getElementById('setScrW').value = cfg.scrW;
        document.getElementById('setScrH').value = cfg.scrH;
        document.getElementById('swBack').checked = cfg.swBack;
        document.getElementById('swDate').checked = cfg.swDate;
        document.getElementById('swClock').checked = cfg.swClock;
        document.getElementById('swPen').checked = cfg.swPen;
        document.getElementById('swTrDel').checked = cfg.swTrDel;
        document.getElementById('swAllDel').checked = cfg.swAllDel;
        document.getElementById('setSwImp').checked = cfg.swImp;
        document.getElementById('setSwExp').checked = cfg.swExp;
        document.getElementById('swPdf').checked = cfg.swPdf;
        document.getElementById('swWa').checked = cfg.swWa;
        document.getElementById('setAp').value = cfg.adminPin;
        document.getElementById('setMFS').checked = cfg.mfs;
        let area = document.getElementById('catEditArea'); area.innerHTML = "";
        cfg.cats.forEach((c, i) => {
            area.innerHTML += `<div class="setting-row"><span>${c}</span><div class="flex gap-1"><input type="text" id="cn_${i}" value="${c}" class="w-16 text-[9px] border"><input type="checkbox" id="cs_${i}" ${cfg.catStatus[i]?'checked':''}></div></div>`;
        });
    }
}

function saveSettings() {
    cfg.headCol = document.getElementById('setHeadCol').value;
    cfg.nameCol = document.getElementById('setNameCol').value;
    cfg.outCol = document.getElementById('setOutCol').value;
    cfg.btmCol = document.getElementById('setBtmCol').value;
    cfg.catLetCol = document.getElementById('setCatLetCol').value;
    cfg.catNumCol = document.getElementById('setCatNumCol').value;
    cfg.title = document.getElementById('setName').value;
    cfg.fsDT = document.getElementById('fsDT').value;
    cfg.fsCatL = document.getElementById('fsCatL').value;
    cfg.fsCatN = document.getElementById('fsCatN').value;
    cfg.fsEnt = document.getElementById('fsEnt').value;
    cfg.scrW = document.getElementById('setScrW').value;
    cfg.scrH = document.getElementById('setScrH').value;
    cfg.swBack = document.getElementById('swBack').checked;
    cfg.swDate = document.getElementById('swDate').checked;
    cfg.swClock = document.getElementById('swClock').checked;
    cfg.swPen = document.getElementById('swPen').checked;
    cfg.swTrDel = document.getElementById('swTrDel').checked;
    cfg.swAllDel = document.getElementById('swAllDel').checked;
    cfg.swImp = document.getElementById('setSwImp').checked;
    cfg.swExp = document.getElementById('setSwExp').checked;
    cfg.swPdf = document.getElementById('swPdf').checked;
    cfg.swWa = document.getElementById('swWa').checked;
    cfg.adminPin = document.getElementById('setAp').value;
    cfg.mfs = document.getElementById('setMFS').checked;
    cfg.cats.forEach((_, i) => { cfg.cats[i] = document.getElementById(`cn_${i}`).value.toUpperCase(); cfg.catStatus[i] = document.getElementById(`cs_${i}`).checked; });
    localStorage.setItem('saha_v65_cfg', JSON.stringify(cfg)); location.reload();
}

function closeSettings() { document.getElementById('setModal').classList.add('hidden'); }
function del(id) { if(confirm("DELETE?")) { db = db.filter(x => x.id !== id); localStorage.setItem('saha_v65_db', JSON.stringify(db)); refresh(); } }
function deleteAll() { if(confirm("ALL CLEAR?")) { db = []; localStorage.setItem('saha_v65_db', JSON.stringify(db)); refresh(); } }
function downloadPDF() { const { jsPDF } = window.jspdf; const doc = new jsPDF(); doc.text(cfg.title + " Report", 14, 15); doc.autoTable({ html: '#mainTable', startY: 20, theme: 'grid' }); doc.save('Report.pdf'); }
function sendWhatsApp() { let msg = `*${cfg.title}*\nTotal: ${document.getElementById('mainTotal').innerText}`; window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank'); }
function exportData() { const blob = new Blob([JSON.stringify(db)], {type: 'application/json'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'backup.json'; a.click(); }
function importData(e) { const reader = new FileReader(); reader.onload = (f) => { db = JSON.parse(f.target.result); localStorage.setItem('saha_v65_db', JSON.stringify(db)); location.reload(); }; reader.readAsText(e.target.files[0]); }
</script>
</body>
</html>